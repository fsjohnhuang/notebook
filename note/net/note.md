## 第2章 - TCP的构成
### TCP 三次握手
客户端发起
SYN (x=rand())
服务端响应
SYN ACK (x+=1,y=rand())
客户端发送
ACK (x+=1, y+=1)
+
应用数据

TFO(TCP Fast Open，TCP快速打开)
减少新建TCP连接的性能损失，Linux3.7+内核客户端和服务端都已经支持。
限制：
1.随SYN分组一起发送的数据净荷有上限
2.只能发送某些类型的HTTP请求
3.依赖加密cookie，只能用于重复的连接。

### 拥塞崩溃
当数据报往返时间超过主机的最大中断间隔时，主机会向网络发送更多的数据报副本，然后大量数据报副本填满各网络节点的缓冲区，导致网络节点和目标主机无法处理其他有效的数据报，甚至有效数据报会被删除。
当网络带宽和传输速度不同的网络，且网络节点数多时，这样的现象较易发生。

TCP的应对机制：流量控制，拥塞控制和拥塞预防
#### 流量控制
应用场景：针对发送端向接收端发送过多数据的机制。
机制描述：双方在每次通信中均告知对方自己的接收窗口(rwnd)，然后发送端根据接收端的rwnd来发送数据。

rwnd，就是告诉发送端，接收端每次响应ACK分组前，可向其发送的最大数据报文段。
若设置rwnd为1，则称为"等停协议"，即发送端每发送一个数据报文后，要等待接收端响应ACK分组后才能发送下一个。

窗口缩放(TCP Window Scaling)
默认rwnd上限是65535 Byte(报文中占16bit)，窗口缩放则可在TCP三次握手中设置rwnd占报文32bit。
```
# 检查当前主机是否启用窗口缩放
$ sysctl net.ipv4.tcp_window_scaling

# 启用窗口缩放
$ sysctl -w net.ipv4.tcp_window_scaling=1

```
